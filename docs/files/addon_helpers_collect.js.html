<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/helpers/collect.js - ember-collect-helper</title>
    <meta name="description" content="Ember.computed.collect as a template helper">
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/theme.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700' rel='stylesheet' type='text/css'>
    

</head>
<body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a href="../" class="navbar-brand">
              <img src="../assets/img/ember-logo.png" alt="enterprise logo">
            <span>collect-helper</span>
          </a>
        </div>

        <div class="collapse navbar-collapse" id="nav">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/buschtoens/ember-collect-helper" class="fa fa-github github"></a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div id="main-wrapper" class="row">
        <div id="content-wrapper">
            <ol class="panel-group" id="sidebar" role="tablist" aria-multiselectable="true">
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-search-heading">
                        <h4 class="panel-title">
                      <a role="button" data-toggle="collapse" href="#sidebar-search" aria-expanded="true" aria-controls="collapseOne">
                        Search
                      </a>
                    </h4>
                    </div>
                    <div id="sidebar-search" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-search-heading">
                        <div class="panel-body">
                            <div id="api-tabview-filter">
                                <input type="search" id="api-filter" placeholder="Search...">
                            </div>
                        </div>
                    </div>
                </li>
                    <li class="panel panel-default">
                        <div class="panel-heading" role="tab" id="sidebar-version-heading">
                            <h4 class="panel-title">
                                <a role="button" href="https://github.com/buschtoens/ember-collect-helper/commits/v0.1.2" target="_blank">
                                  Tag: v0.1.2
                                </a>
                            </h4>
                        </div>
                    </li>
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-modules-heading">
                        <h4 class="panel-title">
                    <a role="button" data-toggle="collapse" href="#sidebar-modules" aria-expanded="true" aria-controls="collapseOne">
                      Modules
                    </a>
                  </h4>
                    </div>
                    <div id="sidebar-modules" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-modules-heading">
                        <div class="panel-body">
                                <ol>
                                        <li>
                                            <a href="../modules/EmberCollectHelper.html">EmberCollectHelper</a>
                                        </li>
                                </ol>
                        </div>
                    </div>
                </li>
            
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-classes-heading">
                        <h4 class="panel-title">
                      <a role="button" data-toggle="collapse" href="#sidebar-classes" aria-expanded="true" aria-controls="collapseOne">
                        Classes
                      </a>
                    </h4>
                    </div>
                    <div id="sidebar-classes" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-classes-heading">
                        <div class="panel-body">
                            <ol>
                                    <li>
                                        <a href="../classes/CollectHelper.html">CollectHelper</a>
                                    </li>
                            </ol>
                        </div>
                    </div>
                </li>
            </ol>
            <div class="content-container">
                <div class="apidocs">
                    <div id="docs-main">
                        <div class="content">
<div class="page-header">
    <h1><i class="fa fa-file-code-o" aria-hidden="true"></i>  File</h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
import Helper from &#x27;@ember/component/helper&#x27;;
import { get, getWithDefault, set } from &#x27;@ember/object&#x27;;
import { A, makeArray } from &#x27;@ember/array&#x27;;
import { isPresent } from &#x27;@ember/utils&#x27;;

const EMPTY_ARRAY = Object.freeze(A([]));

/**
 * The &#x60;{{collect}}&#x60; helper takes a &#x60;source&#x60; object, a &#x60;paths&#x60; array and an
 * optional &#x60;defaultValue&#x60;, which is used if a given path cannot be found on the
 * &#x60;source&#x60; object. The &#x60;defaultValue&#x60; defaults to &#x60;null&#x60;.
 *
 * &#x60;&#x60;&#x60;hbs
 * {{collect source paths defaultValue=&quot;foo&quot;}}
 * &#x60;&#x60;&#x60;
 *
 * If the &#x60;source&#x60; [is empty](https://www.emberjs.com/api/ember/2.14/namespaces/Ember/methods/isEmpty?anchor=isEmpty),
 * the helper will return an empty array (&#x60;[]&#x60;), regardless of the &#x60;paths&#x60; that
 * were specified.
 *
 * If a specified path was not found on the &#x60;source&#x60; object, &#x60;defaultValue&#x60; is
 * put in its place.
 *
 * &#x60;&#x60;&#x60;js
 * const source = {
 *   foo: &#x27;ember&#x27;,
 *   bar: &#x27;light&#x27;,
 *   qux: {
 *     quax: &#x27;table&#x27;,
 *     quuz: &#x27;great&#x27;
 *   }
 *  };
 *  const paths = [&#x27;bar&#x27;, &#x27;qux.quax&#x27;, &#x27;unknown&#x27;, &#x27;qux.quuz&#x27;];
 * &#x60;&#x60;&#x60;
 *
 * &#x60;&#x60;&#x60;hbs
 * {{#each (collect source paths defaultValue=&quot;is&quot;) as |word|}}
 *   {{word}}
 * {{/each}}
 * &#x60;&#x60;&#x60;
 *
 * &#x60;&#x60;&#x60;html
 * light table is great
 * &#x60;&#x60;&#x60;
 *
 * The specified &#x60;paths&#x60; on the &#x60;source&#x60; object are observed. This means that
 * updating these values on the &#x60;source&#x60; object will cause the helper to
 * recompute, just as you would expect.
 * You can also replace the &#x60;source&#x60; object altogether or change the specified
 * &#x60;paths&#x60;. Everything will always stay in sync.
 *
 * To allow maximum flexibility, &#x60;paths&#x60; can also be a string, in which case the
 * value is returned as is and not wrapped in an array.
 * This means that the following two invocations have different return values:
 *
 * &#x60;&#x60;&#x60;js
 * const source = { foo: &#x27;bar&#x27; };
 * const arrayPath = [&#x27;foo&#x27;];
 * const singularPath = &#x27;foo&#x27;;
 * &#x60;&#x60;&#x60;
 *
 * &#x60;&#x60;&#x60;hbs
 * {{collect source arrayPath}}    =&gt; [&#x27;bar&#x27;]
 * {{collect source singularPath}} =&gt; &#x27;bar&#x27;
 * &#x60;&#x60;&#x60;
 *
 * This is especially useful, when you are replacing &#x60;{{get}}&#x60; with
 * &#x60;{{collect}}&#x60;, but have some surrounding code that still expects the
 * unwrapped value for cases where &#x60;paths&#x60; is not an array, but also just a
 * single path, as it would be with &#x60;{{get}}&#x60;.
 *
 * You can disable this behavior and make &#x60;{{collect}}&#x60; always return an array
 * by passing &#x60;wrapSingular=true&#x60;.
 *
 * &#x60;&#x60;&#x60;hbs
 * {{collect source &quot;foo&quot; wrapSingular=true}} =&gt; [&#x27;bar&#x27;]
 * &#x60;&#x60;&#x60;
 *
 * @module EmberCollectHelper
 * @class CollectHelper
 * @extends Ember.Helper
 */
export default class extends Helper {
  /**
   * The source object whose paths are observed for changes.
   *
   * @property source
   * @type {Object|null}
   * @private
   */
  source = null;

  /**
   * The paths on &#x60;source&#x60; to collect values from and observe for changes.
   *
   * @property paths
   * @type {String[]}
   * @default []
   * @private
   */
  paths = EMPTY_ARRAY;

  /**
   * @property isSingular
   * @type {Boolean}
   * @default false
   * @private
   */
  isSingular = false;

  /**
   * @method compute
   * @param  {Object}   source The object to collect values from
   * @param  {String[]} paths  The paths to collect
   * @param  {Object}   options
   * @param  {Object}   [options.defaultValue=null]
   * @param  {Object}   [options.wrapSingular=false]
   * @return {Array} If the given &#x60;source&#x60; is present, returns an array of the
   *   collected values in the order that they were specified in &#x60;paths&#x60;.
   *   If the given &#x60;source&#x60; is empty, returns an empty array (&#x60;[]&#x60;).
   */
  compute([source, paths], { defaultValue = null, wrapSingular = false }) {
    this.updateSource(source);
    this.updatePaths(A(makeArray(paths)), {
      isSingular: typeof paths === &#x27;string&#x27; || typeof paths === &#x27;number&#x27;
    });

    return this.collectValues({ defaultValue, wrapSingular });
  }

  /**
   * Updates the &#x60;source&#x60; object.
   *
   * @method updateSource
   * @param  {Object} newSource
   * @return {Boolean} If the &#x60;newSource&#x60; actually was different from the old
   *    source and thus an update was performed.
   * @private
   */
  updateSource(newSource) {
    const oldSource = get(this, &#x27;source&#x27;);

    if (oldSource !== newSource) {
      set(this, &#x27;source&#x27;, newSource);
      return true;
    }

    return false;
  }

  /**
   * Updates the &#x60;paths&#x60; that are collected and observed for changes.
   * Also updates the observers on the &#x60;source&#x60; object.
   *
   * @method updatePaths
   * @param  {String[]} newPaths
   * @param  {Object}   [options]
   * @param  {Boolean}  [options.isSingular=false]
   * @return {Boolean} If the &#x60;newPaths&#x60; were actually different from the old
   *   paths and thus an update was performed.
   * @private
   */
  updatePaths(newPaths, { isSingular = false } = {}) {
    // &#x60;getWithDefault&#x60; is required for compatibility with Ember 2.4
    // https://github.com/buschtoens/ember-collect-helper/issues/5#issuecomment-316344099
    const oldPaths = getWithDefault(this, &#x27;paths&#x27;, EMPTY_ARRAY);

    set(this, &#x27;isSingular&#x27;, isSingular);

    if (get(oldPaths, &#x27;length&#x27;) === get(newPaths, &#x27;length&#x27;)) {
      if (oldPaths.every((path, i) =&gt; path === newPaths.objectAt(i))) {
        return false;
      }
    }

    oldPaths.forEach(path =&gt; this.removeObserver(&#x60;source.${path}&#x60;, this, &#x27;observedPathsChanged&#x27;));
    newPaths.forEach(path =&gt; this.addObserver(&#x60;source.${path}&#x60;, this, &#x27;observedPathsChanged&#x27;));

    set(this, &#x27;paths&#x27;, newPaths);

    return true;
  }

  /**
   * Called everytime an observed property on the &#x60;source&#x60; object changes.
   * Causes the helper to recomputed its value.
   *
   * @method observedPathsChanged
   * @private
   */
  observedPathsChanged(/* sender, key, value, rev */) {
    // Wrapping in &#x60;scheduleOnce&#x60; isn&#x27;t necessary, as &#x60;recompute&#x60; already batches calls together.
    this.recompute();
  }

  /**
   * Collects the specified &#x60;paths&#x60; from the &#x60;source&#x60; object, if present.
   *
   * @method collectValues
   * @param  {Object}  [options]
   * @param  {Boolean} [options.defaultValue=null] The value to be used when a
   *   paths cannot be found on the &#x60;source&#x60; object. Effectively what you would
   *   pass to &#x60;Ember.getWithDefault&#x60;.
   * @param  {Boolean} [options.wrapSingular=false]
   * @return {Array} If the given &#x60;source&#x60; is present, returns an array of the
   *   collected values in the order that they were specified in &#x60;paths&#x60;.
   *   If the given &#x60;source&#x60; is empty, returns an empty array (&#x60;[]&#x60;).
   *   If paths were not found in &#x60;source&#x60;, &#x60;defaultValue&#x60; will be inserted in
   *   their place.
   * @private
   */
  collectValues({ defaultValue = null, wrapSingular = false } = {}) {
    const source = get(this, &#x27;source&#x27;);
    const paths = get(this, &#x27;paths&#x27;);
    const shouldUnwrap = get(this, &#x27;isSingular&#x27;) &amp;&amp; !wrapSingular;

    if (isPresent(source)) {
      const values =  paths.map(path =&gt; getWithDefault(source, path, defaultValue));

      return shouldUnwrap ? values[0] : values;
    }

    return shouldUnwrap ? defaultValue : [];
  }
}

    </pre>
</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../assets/vendor/prettify/prettify-min.js"></script>
    <script>prettyPrint();</script>
    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="../assets/vendor/jquery-ui/jquery-ui.min.js"></script>
    <script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
    <script src="../assets/vendor/github-slugger/slugger.js"></script>
    <script src="../assets/js/yuidoc-bootstrap.js"></script>
</body>
</html>
